#!/bin/sh

. /etc/profile

export SDL_MOUSE_RELATIVE=0
export FB_MULTI_BUFFER=2
export DISPLAY=:0.0

# Stop Kodi if it's running
pidof kodi.bin > /dev/null && KODI=1
[ "$KODI" = "1" ] && systemctl stop kodi

# Switch to VT2
[ ! -f /storage/.config/retroarch/no_kms ] && chvt 2

# Launch RetroArch
/usr/bin/retroarch "$@" > /tmp/retroarch.log 2>&1

# Switch back to VT1
[ ! -f /storage/.config/retroarch/no_kms ] && chvt 1

# Restart Kodi
[ "$KODI" = "1" ] && systemctl start kodi
